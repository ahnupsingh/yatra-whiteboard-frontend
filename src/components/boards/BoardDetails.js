import React, { useState, useEffect, Fragment } from "react";
import { TextEditor } from "../pages";
import { CanvasEditor } from "../pages";
import { Segment, Card, Grid, Button, Dropdown } from "semantic-ui-react";
import { getBoardDetails, updateBoard } from "../../request";

export function BoardDetails(props) {
    const [board, setBoard] = useState({});
    const [sections, setSections] = useState([]);
    const [addingSection, setAddingSection] = useState(false);
    const idx = props.match.params.idx;

    const uResponse = {
        extras: {
            "1948738880afdlk": {
                type: "text-editor",
                data:
                    '<div><!--block-->aaadfdafadfadfdasfdasfdf<br>hello world my name is text editor</div><h1><!--block--><strong>मेरो नाम </strong><a href="http://fb.com/ahhnupsingh"><strong>अनुप</strong></a><strong> कुमार सिंह हो&nbsp;</strong></h1>',
            },

            ldsfjjlkdasfjkl: {
                type: "canvas-editor",
                imgSrc:
                    "https://lh3.googleusercontent.com/GBm5XIFmoXROY-tELop17jsz8u2OtEElp2xfZtiXJJ7T0uWLapMeglUkcCAR07QUGJ4s=w412-h220-rw",
                data:
                    '{"lines":[{"points":[{"x":20,"y":88.53125},{"x":20,"y":88.53125},{"x":20,"y":88.53125},{"x":20,"y":87.53125},{"x":20,"y":86.53125},{"x":21,"y":84.53125},{"x":22,"y":83.53125},{"x":23,"y":81.53125},{"x":24,"y":80.53125},{"x":25,"y":79.53125},{"x":26,"y":76.53125},{"x":28,"y":74.53125},{"x":30,"y":72.53125},{"x":33,"y":68.53125},{"x":36,"y":64.53125},{"x":40,"y":60.53125},{"x":44,"y":54.53125},{"x":48,"y":48.53125},{"x":54,"y":41.53125},{"x":58,"y":34.53125},{"x":62,"y":28.53125},{"x":66,"y":23.53125},{"x":69,"y":19.53125},{"x":72,"y":16.53125},{"x":74,"y":13.53125},{"x":75,"y":11.53125},{"x":76,"y":10.53125},{"x":77,"y":9.53125},{"x":78,"y":9.53125},{"x":78,"y":8.53125},{"x":79,"y":7.53125},{"x":81,"y":5.53125},{"x":83,"y":3.5312499999999996},{"x":85,"y":1.53125},{"x":87,"y":-0.46875000000000044},{"x":88,"y":-2.46875}],"brushColor":"#E01F1F","brushRadius":12},{"points":[{"x":22,"y":182.53125},{"x":22,"y":182.53125},{"x":24,"y":178.53125},{"x":29,"y":171.53125},{"x":34,"y":161.53125},{"x":41,"y":150.53125},{"x":47,"y":141.53125},{"x":52,"y":133.53125},{"x":56,"y":125.53125},{"x":60,"y":117.53125},{"x":64,"y":111.53125},{"x":69,"y":105.53125},{"x":73,"y":99.53125},{"x":77,"y":93.53125},{"x":81,"y":88.53125},{"x":84,"y":84.53125},{"x":86,"y":82.53125},{"x":87,"y":79.53125},{"x":89,"y":78.53125},{"x":90,"y":76.53125},{"x":92,"y":75.53125},{"x":94,"y":73.53125},{"x":96,"y":71.53125},{"x":97,"y":70.53125},{"x":98,"y":69.53125},{"x":100,"y":67.53125},{"x":101,"y":66.53125},{"x":102,"y":65.53125},{"x":104,"y":63.53125},{"x":106,"y":61.53125},{"x":107,"y":59.53125},{"x":110,"y":56.53125},{"x":112,"y":54.53125},{"x":114,"y":52.53125},{"x":115,"y":50.53125},{"x":117,"y":48.53125},{"x":118,"y":47.53125},{"x":120,"y":45.53125},{"x":122,"y":43.53125},{"x":124,"y":40.53125},{"x":126,"y":37.53125},{"x":128,"y":35.53125},{"x":130,"y":32.53125},{"x":132,"y":30.53125},{"x":133,"y":28.53125},{"x":134,"y":27.53125},{"x":135,"y":25.53125},{"x":136,"y":24.53125},{"x":136,"y":23.53125},{"x":137,"y":23.53125},{"x":138,"y":22.53125},{"x":139,"y":21.53125},{"x":140,"y":20.53125},{"x":141,"y":18.53125},{"x":143,"y":17.53125},{"x":145,"y":15.53125},{"x":146,"y":13.53125},{"x":147,"y":12.53125},{"x":149,"y":10.53125},{"x":150,"y":9.53125},{"x":150,"y":8.53125},{"x":151,"y":7.53125},{"x":151,"y":7.53125},{"x":152,"y":6.53125},{"x":152,"y":6.53125}],"brushColor":"#417505","brushRadius":12},{"points":[{"x":26,"y":254.53125},{"x":26,"y":254.53125},{"x":27,"y":253.53125},{"x":28,"y":251.53125},{"x":30,"y":248.53125},{"x":32,"y":246.53125},{"x":35,"y":244.53125},{"x":38,"y":241.53125},{"x":41,"y":238.53125},{"x":45,"y":234.53125},{"x":50,"y":229.53125},{"x":56,"y":222.53125},{"x":62,"y":215.53125},{"x":68,"y":207.53125},{"x":76,"y":199.53125},{"x":82,"y":192.53125},{"x":89,"y":184.53125},{"x":93,"y":178.53125},{"x":98,"y":173.53125},{"x":102,"y":168.53125},{"x":107,"y":163.53125},{"x":111,"y":159.53125},{"x":114,"y":155.53125},{"x":117,"y":152.53125},{"x":120,"y":149.53125},{"x":123,"y":145.53125},{"x":126,"y":142.53125},{"x":130,"y":139.53125},{"x":133,"y":135.53125},{"x":136,"y":131.53125},{"x":140,"y":127.53125},{"x":143,"y":123.53125},{"x":147,"y":118.53125},{"x":151,"y":113.53125},{"x":154,"y":109.53125},{"x":156,"y":105.53125},{"x":158,"y":102.53125},{"x":160,"y":100.53125},{"x":162,"y":97.53125},{"x":163,"y":96.53125},{"x":165,"y":93.53125},{"x":167,"y":90.53125},{"x":170,"y":88.53125},{"x":173,"y":85.53125},{"x":175,"y":82.53125},{"x":177,"y":80.53125},{"x":180,"y":77.53125},{"x":181,"y":75.53125},{"x":183,"y":73.53125},{"x":184,"y":72.53125},{"x":185,"y":71.53125},{"x":186,"y":70.53125},{"x":187,"y":68.53125},{"x":189,"y":65.53125},{"x":192,"y":60.53125},{"x":195,"y":55.53125},{"x":198,"y":48.53125},{"x":200,"y":43.53125},{"x":202,"y":37.53125},{"x":204,"y":33.53125},{"x":204,"y":31.53125},{"x":205,"y":28.53125},{"x":206,"y":26.53125},{"x":206,"y":26.53125},{"x":207,"y":25.53125},{"x":207,"y":24.53125},{"x":207,"y":22.53125},{"x":208,"y":19.53125},{"x":210,"y":13.53125},{"x":212,"y":8.53125},{"x":214,"y":3.53125},{"x":216,"y":0.53125},{"x":218,"y":-2.46875}],"brushColor":"#4a90e2","brushRadius":12},{"points":[{"x":19,"y":327.53125},{"x":19,"y":327.53125},{"x":20,"y":326.53125},{"x":21,"y":324.53125},{"x":23,"y":322.53125},{"x":27,"y":319.53125},{"x":34,"y":316.53125},{"x":42,"y":311.53125},{"x":51,"y":305.53125},{"x":61,"y":298.53125},{"x":72,"y":291.53125},{"x":83,"y":283.53125},{"x":95,"y":275.53125},{"x":106,"y":266.53125},{"x":117,"y":257.53125},{"x":128,"y":247.53125},{"x":138,"y":237.53125},{"x":147,"y":228.53125},{"x":155,"y":219.53125},{"x":162,"y":212.53125},{"x":168,"y":205.53125},{"x":173,"y":199.53125},{"x":179,"y":192.53125},{"x":185,"y":185.53125},{"x":192,"y":177.53125},{"x":198,"y":170.53125},{"x":204,"y":163.53125},{"x":209,"y":157.53125},{"x":212,"y":152.53125},{"x":215,"y":148.53125},{"x":218,"y":144.53125},{"x":223,"y":138.53125},{"x":228,"y":132.53125},{"x":234,"y":124.53125},{"x":241,"y":117.53125},{"x":247,"y":108.53125},{"x":253,"y":101.53125},{"x":258,"y":96.53125},{"x":261,"y":92.53125},{"x":264,"y":88.53125},{"x":268,"y":82.53125},{"x":272,"y":77.53125},{"x":276,"y":73.53125},{"x":279,"y":69.53125},{"x":280,"y":67.53125},{"x":281,"y":66.53125},{"x":281,"y":58.53125},{"x":281,"y":51.53125},{"x":281,"y":46.53125},{"x":281,"y":41.53125},{"x":281,"y":38.53125},{"x":281,"y":36.53125},{"x":282,"y":34.53125},{"x":282,"y":33.53125},{"x":282,"y":32.53125},{"x":283,"y":30.53125},{"x":283,"y":28.53125},{"x":284,"y":26.53125},{"x":284,"y":25.53125},{"x":285,"y":23.53125},{"x":285,"y":22.53125},{"x":285,"y":22.53125},{"x":286,"y":20.53125},{"x":286,"y":20.53125},{"x":287,"y":18.53125},{"x":287,"y":18.53125},{"x":288,"y":18.53125},{"x":288,"y":17.53125},{"x":288,"y":16.53125},{"x":288,"y":16.53125},{"x":289,"y":16.53125},{"x":289,"y":15.53125},{"x":289,"y":15.53125}],"brushColor":"#d0021b","brushRadius":12},{"points":[{"x":38,"y":394.53125},{"x":38,"y":394.53125},{"x":38,"y":393.53125},{"x":40,"y":390.53125},{"x":41,"y":388.53125},{"x":45,"y":386.53125},{"x":51,"y":382.53125},{"x":60,"y":377.53125},{"x":70,"y":371.53125},{"x":82,"y":364.53125},{"x":95,"y":356.53125},{"x":107,"y":349.53125},{"x":118,"y":343.53125},{"x":128,"y":336.53125},{"x":137,"y":329.53125},{"x":148,"y":321.53125},{"x":159,"y":313.53125},{"x":169,"y":304.53125},{"x":179,"y":295.53125},{"x":189,"y":286.53125},{"x":198,"y":277.53125},{"x":208,"y":269.53125},{"x":216,"y":262.53125},{"x":224,"y":254.53125},{"x":232,"y":246.53125},{"x":242,"y":238.53125},{"x":252,"y":230.53125},{"x":263,"y":223.53125},{"x":274,"y":215.53125},{"x":284,"y":208.53125},{"x":295,"y":201.53125},{"x":305,"y":195.53125},{"x":315,"y":188.53125},{"x":323,"y":182.53125},{"x":330,"y":177.53125},{"x":336,"y":172.53125},{"x":343,"y":166.53125},{"x":348,"y":161.53125},{"x":353,"y":156.53125},{"x":358,"y":152.53125},{"x":363,"y":147.53125},{"x":367,"y":144.53125},{"x":370,"y":141.53125},{"x":371,"y":139.53125},{"x":373,"y":137.53125},{"x":374,"y":135.53125},{"x":376,"y":132.53125},{"x":379,"y":126.53125},{"x":381,"y":119.53125},{"x":383,"y":112.53125},{"x":384,"y":107.53125},{"x":385,"y":103.53125},{"x":385,"y":100.53125},{"x":385,"y":98.53125},{"x":386,"y":96.53125},{"x":386,"y":95.53125},{"x":386,"y":93.53125},{"x":386,"y":91.53125},{"x":386,"y":89.53125},{"x":385,"y":86.53125},{"x":383,"y":82.53125},{"x":382,"y":78.53125},{"x":381,"y":74.53125},{"x":378,"y":70.53125},{"x":377,"y":67.53125},{"x":376,"y":65.53125},{"x":375,"y":63.53125},{"x":373,"y":61.53125},{"x":372,"y":60.53125},{"x":372,"y":60.53125},{"x":371,"y":59.53125},{"x":370,"y":58.53125},{"x":370,"y":58.53125},{"x":370,"y":58.53125},{"x":369,"y":57.53125},{"x":369,"y":57.53125},{"x":369,"y":57.53125},{"x":369,"y":57.53125}],"brushColor":"#7ed321","brushRadius":12},{"points":[{"x":260,"y":382.53125},{"x":260,"y":382.53125},{"x":260,"y":379.53125},{"x":262,"y":373.53125},{"x":264,"y":367.53125},{"x":266,"y":360.53125},{"x":269,"y":352.53125},{"x":273,"y":342.53125},{"x":276,"y":332.53125},{"x":279,"y":323.53125},{"x":282,"y":313.53125},{"x":285,"y":304.53125},{"x":288,"y":296.53125},{"x":290,"y":288.53125},{"x":292,"y":283.53125},{"x":294,"y":278.53125},{"x":295,"y":275.53125},{"x":296,"y":273.53125},{"x":297,"y":271.53125},{"x":298,"y":269.53125},{"x":299,"y":266.53125},{"x":301,"y":261.53125},{"x":304,"y":255.53125},{"x":305,"y":250.53125},{"x":307,"y":247.53125},{"x":309,"y":244.53125},{"x":310,"y":242.53125},{"x":310,"y":240.53125},{"x":311,"y":239.53125},{"x":312,"y":238.53125},{"x":313,"y":236.53125},{"x":314,"y":234.53125},{"x":315,"y":233.53125},{"x":316,"y":232.53125},{"x":316,"y":231.53125},{"x":317,"y":231.53125},{"x":318,"y":230.53125},{"x":319,"y":229.53125},{"x":320,"y":228.53125},{"x":321,"y":227.53125},{"x":322,"y":226.53125},{"x":324,"y":224.53125},{"x":325,"y":223.53125},{"x":326,"y":222.53125},{"x":327,"y":222.53125},{"x":329,"y":221.53125},{"x":329,"y":220.53125},{"x":330,"y":220.53125},{"x":330,"y":219.53125},{"x":331,"y":219.53125},{"x":332,"y":218.53125},{"x":333,"y":218.53125},{"x":334,"y":217.53125},{"x":334,"y":217.53125},{"x":335,"y":217.53125},{"x":336,"y":218.53125},{"x":337,"y":219.53125},{"x":339,"y":221.53125},{"x":341,"y":225.53125},{"x":344,"y":229.53125},{"x":346,"y":233.53125},{"x":347,"y":237.53125},{"x":349,"y":241.53125},{"x":351,"y":246.53125},{"x":353,"y":250.53125},{"x":355,"y":255.53125},{"x":357,"y":260.53125},{"x":359,"y":266.53125},{"x":361,"y":271.53125},{"x":362,"y":276.53125},{"x":364,"y":282.53125},{"x":366,"y":288.53125},{"x":369,"y":294.53125},{"x":370,"y":300.53125},{"x":372,"y":308.53125},{"x":373,"y":314.53125},{"x":374,"y":320.53125},{"x":375,"y":324.53125},{"x":375,"y":328.53125},{"x":376,"y":331.53125},{"x":376,"y":332.53125},{"x":376,"y":334.53125},{"x":377,"y":336.53125},{"x":377,"y":338.53125},{"x":377,"y":341.53125},{"x":378,"y":343.53125},{"x":378,"y":345.53125},{"x":378,"y":346.53125},{"x":378,"y":348.53125},{"x":378,"y":349.53125},{"x":378,"y":350.53125},{"x":378,"y":350.53125},{"x":378,"y":351.53125},{"x":378,"y":351.53125},{"x":378,"y":352.53125},{"x":378,"y":352.53125},{"x":378,"y":353.53125},{"x":378,"y":353.53125},{"x":378,"y":353.53125},{"x":378,"y":354.53125},{"x":378,"y":354.53125}],"brushColor":"#bd10e0","brushRadius":12},{"points":[{"x":292,"y":321.53125},{"x":292,"y":321.53125},{"x":293,"y":320.53125},{"x":296,"y":318.53125},{"x":302,"y":316.53125},{"x":309,"y":313.53125},{"x":315,"y":311.53125},{"x":323,"y":308.53125},{"x":329,"y":306.53125},{"x":336,"y":303.53125},{"x":342,"y":301.53125},{"x":346,"y":300.53125},{"x":348,"y":300.53125},{"x":351,"y":299.53125},{"x":352,"y":298.53125},{"x":353,"y":298.53125},{"x":353,"y":298.53125},{"x":354,"y":297.53125},{"x":355,"y":297.53125},{"x":355,"y":297.53125},{"x":356,"y":297.53125},{"x":357,"y":297.53125},{"x":357,"y":297.53125},{"x":357,"y":297.53125}],"brushColor":"#bd10e0","brushRadius":12},{"points":[{"x":195,"y":339.53125},{"x":195,"y":339.53125},{"x":195,"y":340.53125},{"x":194,"y":340.53125},{"x":192,"y":341.53125},{"x":191,"y":342.53125},{"x":189,"y":343.53125},{"x":187,"y":344.53125},{"x":186,"y":346.53125},{"x":185,"y":347.53125},{"x":184,"y":348.53125},{"x":182,"y":350.53125},{"x":182,"y":352.53125},{"x":182,"y":353.53125},{"x":182,"y":355.53125},{"x":182,"y":356.53125},{"x":182,"y":358.53125},{"x":181,"y":359.53125},{"x":181,"y":360.53125},{"x":181,"y":361.53125},{"x":181,"y":362.53125},{"x":181,"y":363.53125},{"x":181,"y":364.53125},{"x":181,"y":364.53125},{"x":182,"y":364.53125},{"x":182,"y":364.53125},{"x":182,"y":365.53125},{"x":183,"y":365.53125},{"x":184,"y":365.53125},{"x":185,"y":365.53125},{"x":187,"y":366.53125},{"x":189,"y":366.53125},{"x":190,"y":366.53125},{"x":192,"y":366.53125},{"x":194,"y":365.53125},{"x":196,"y":365.53125},{"x":197,"y":364.53125},{"x":199,"y":364.53125},{"x":200,"y":363.53125},{"x":201,"y":363.53125},{"x":203,"y":363.53125},{"x":204,"y":362.53125},{"x":205,"y":361.53125},{"x":206,"y":361.53125},{"x":207,"y":361.53125},{"x":207,"y":361.53125},{"x":208,"y":360.53125},{"x":208,"y":360.53125},{"x":209,"y":360.53125},{"x":209,"y":359.53125},{"x":209,"y":359.53125},{"x":210,"y":359.53125},{"x":210,"y":359.53125},{"x":211,"y":358.53125},{"x":211,"y":358.53125},{"x":212,"y":358.53125},{"x":212,"y":358.53125},{"x":212,"y":358.53125},{"x":212,"y":358.53125},{"x":213,"y":358.53125},{"x":213,"y":359.53125},{"x":214,"y":359.53125},{"x":214,"y":360.53125},{"x":214,"y":362.53125},{"x":214,"y":363.53125},{"x":214,"y":365.53125},{"x":214,"y":367.53125},{"x":213,"y":368.53125},{"x":213,"y":369.53125},{"x":212,"y":371.53125},{"x":211,"y":372.53125},{"x":211,"y":373.53125},{"x":210,"y":375.53125},{"x":210,"y":375.53125},{"x":210,"y":376.53125},{"x":209,"y":376.53125},{"x":209,"y":377.53125},{"x":209,"y":378.53125},{"x":209,"y":379.53125},{"x":208,"y":379.53125},{"x":208,"y":379.53125},{"x":208,"y":380.53125},{"x":207,"y":380.53125},{"x":207,"y":380.53125},{"x":207,"y":380.53125},{"x":206,"y":381.53125},{"x":206,"y":381.53125},{"x":206,"y":381.53125},{"x":206,"y":381.53125},{"x":206,"y":382.53125},{"x":205,"y":382.53125},{"x":205,"y":382.53125},{"x":205,"y":382.53125},{"x":205,"y":382.53125},{"x":205,"y":383.53125},{"x":205,"y":383.53125}],"brushColor":"#bd10e0","brushRadius":4}],"width":400,"height":400}',
            },
        },
    };

    useEffect(() => {
        if (idx !== undefined) {
            getBoardDetails(idx).then((response) => {
                debugger;
                const boardValues = Object.entries(response.data.extras).map(
                    ([k, v]) => {
                        return { key: k, ...v };
                    }
                );
                setBoard(response.data);
                setSections([...sections, ...boardValues]);
            });
        } else {
            setSections([...sections, { type: "text-editor" }]);
        }
    }, []);

    return (
        <div className="ui container">
            <h3 className="ui header">
                {board.title ? board.title : "New Board"}
            </h3>
            <Segment attached>
                {sections.length == 0 && (
                    <img src="https://react.semantic-ui.com/images/wireframe/paragraph.png" />
                )}
                {sections.map((section, index) => {
                    if (section.type == "text-editor") {
                        return (
                            <Fragment>
                                <Grid stackable columns={2}>
                                    <Grid.Column floated="right" width={12}>
                                        <Button
                                            basic
                                            color="red"
                                            className="right floated"
                                            onClick={() => {
                                                debugger;
                                                var array = sections;
                                                array = array.splice(index, 1);
                                                setSections(array);
                                            }}
                                        >
                                            X
                                        </Button>
                                    </Grid.Column>
                                </Grid>
                                <Card fluid>
                                    <Card.Content>
                                        <TextEditor
                                            idx={idx}
                                            keyID={section.key}
                                            initialValue={section.data}
                                            {...props}
                                        ></TextEditor>
                                    </Card.Content>
                                </Card>
                            </Fragment>
                        );
                    } else if (section.type == "canvas-editor") {
                        return (
                            <Fragment>
                                <Grid stackable columns={2}>
                                    <Grid.Column floated="right" width={12}>
                                        <Button
                                            basic
                                            color="red"
                                            className="right floated"
                                            onClick={() => {
                                                setSections(
                                                    sections.splice(index, 1)
                                                );
                                            }}
                                        >
                                            X
                                        </Button>
                                    </Grid.Column>
                                </Grid>
                                <Card fluid>
                                    <Card.Content>
                                        <CanvasEditor
                                            idx={idx}
                                            keyID={section.key}
                                            saveData={section.data}
                                            imgSrc={section.imgSrc}
                                        ></CanvasEditor>
                                    </Card.Content>
                                </Card>
                            </Fragment>
                        );
                    } else {
                        return <Segment fluid placeholder></Segment>;
                    }
                })}
            </Segment>
            <Button.Group attached="bottom">
                <Button
                    color="teal"
                    onClick={() => {
                        setSections([...sections, { type: "text-editor" }]);
                        setAddingSection(false);
                    }}
                >
                    Add Text Editor
                </Button>
                <Button
                    color="teal"
                    onClick={() => {
                        setSections([...sections, { type: "canvas-editor" }]);
                        setAddingSection(false);
                    }}
                >
                    Add Canvas
                </Button>
            </Button.Group>

            <Grid stackable columns={2}>
                <Grid.Column className="text-center" width={12}></Grid.Column>
            </Grid>
        </div>
    );
}
